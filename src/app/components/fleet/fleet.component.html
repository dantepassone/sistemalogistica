<div class="fleet-container">
  <div class="header-section">
    <h1>Flota y Recursos</h1>
    <p>Gestión de vehículos, horarios, mantenimiento y asignación a rutas</p>
  </div>

  <div class="fleet-stats">
    <div class="stat-item">
      <h3>Total Vehículos</h3>
      <p class="stat-number">{{ vehicles.length }}</p>
    </div>
    <div class="stat-item">
      <h3>Disponibles</h3>
      <p class="stat-number">{{ getDisponibles() }}</p>
    </div>
    <div class="stat-item">
      <h3>En Ruta</h3>
      <p class="stat-number">{{ getEnRuta() }}</p>
    </div>
    <div class="stat-item">
      <h3>En Mantenimiento</h3>
      <p class="stat-number">{{ getEnMantenimiento() }}</p>
    </div>
  </div>

  <div class="vehicles-grid">
    <div *ngFor="let vehicle of vehicles" class="vehicle-card">
      <div class="vehicle-header">
        <h3>{{ vehicle.patente }}</h3>
        <span class="status-badge" [ngClass]="getStatusClass(vehicle.estado)">
          {{ vehicle.estado }}
        </span>
      </div>
      <div class="vehicle-info">
        <div class="info-row">
          <span class="label">Tipo:</span>
          <span class="value">{{ vehicle.tipo }}</span>
        </div>
        <div class="info-row">
          <span class="label">Capacidad:</span>
          <span class="value">{{ vehicle.capacidad }} kg</span>
        </div>
        <div class="info-row">
          <span class="label">Chofer:</span>
          <span class="value">{{ vehicle.chofer }}</span>
        </div>
        <div class="info-row">
          <span class="label">Ubicación:</span>
          <span class="value">{{ getValor(vehicle.ubicacion) }}</span>
        </div>
        <div class="info-row">
          <span class="label">Zona:</span>
          <span class="value">{{ getValor(vehicle.zonaAsignada) }}</span>
        </div>
        <div class="info-row">
          <span class="label">Kilometraje:</span>
          <span class="value">{{ getKilometraje(vehicle) }} km</span>
        </div>
        <div class="info-row">
          <span class="label">Próximo Mantenimiento:</span>
          <span class="value">{{ getValor(vehicle.proximoMantenimiento) }}</span>
        </div>
        <div class="vehicle-actions">
          <button class="btn-small btn-primary" (click)="selectVehicle(vehicle)">
            Ver / Asignar
          </button>
          <select class="status-select" (change)="cambiarEstado(vehicle, $any($event.target).value)">
            <option value="">Cambiar estado...</option>
            <option *ngFor="let estado of getEstadosPosibles(vehicle.estado)" [value]="estado">
              {{ estado }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Panel de asignación -->
  <div class="assignment-panel" *ngIf="selectedVehicle">
    <div class="panel-header">
      <h2>Asignar Envío - {{ selectedVehicle.patente }}</h2>
      <button class="btn-close" (click)="closeSelection()">✕</button>
    </div>
    <div class="panel-body">
      <div class="vehicle-details">
        <p><strong>Chofer:</strong> {{ selectedVehicle.chofer }}</p>
        <p><strong>Capacidad:</strong> {{ selectedVehicle.capacidad }} kg</p>
        <p><strong>Estado:</strong> {{ selectedVehicle.estado }}</p>
      </div>
      <form (ngSubmit)="asignarEnvio()" class="assignment-form">
        <div class="form-group">
          <label>Seleccionar Envío *</label>
          <select [(ngModel)]="assignmentData.shipmentId" name="shipmentId" required>
            <option value="">Seleccione un envío...</option>
            <option *ngFor="let shipment of availableShipments" [value]="shipment.id">
              {{ shipment.codigoTrazabilidad }} - {{ shipment.destino }} ({{ shipment.peso }} kg)
            </option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeSelection()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="selectedVehicle.estado !== 'Disponible'">
            Asignar Envío
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

